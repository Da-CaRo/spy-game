<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Juego de Esp铆as - Tablero Digital</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilos personalizados para la tipograf铆a del juego */
        .card-text {
            font-size: clamp(0.75rem, 3vw, 1.5rem);
            /* Tama帽o responsivo del texto */
            line-height: 1.2;
        }

        /* Colores de revelaci贸n */
        .bg-red-agent {
            background-color: #dc2626;
            color: white;
        }

        /* Rojo-600 */
        .bg-blue-agent {
            background-color: #2563eb;
            color: white;
        }

        /* Azul-600 */
        .bg-neutral-agent {
            background-color: #f59e0b;
            color: white;
        }

        /* mbar-500 */
        .bg-assassin {
            background-color: #1f2937;
            color: white;
        }

        /* Gris-800 */
    </style>
</head>

<body class="bg-gray-900 text-white p-4 sm:p-8 min-h-screen flex flex-col items-center">

    <header class="w-full max-w-6xl mb-4 text-center">
        <h1 class="text-4xl sm:text-5xl font-extrabold text-yellow-400 tracking-wider uppercase">
            Juego de Esp铆as
        </h1>
    </header>

    <main class="w-full max-w-6xl">

        <div class="flex flex-col sm:flex-row justify-between items-center w-full mb-6">

            <div id="game-info"
                class="flex justify-between items-center w-full sm:w-auto text-xl sm:text-2xl font-semibold mb-4 sm:mb-0 space-x-4">
                <div id="blue-score" class="text-blue-400 bg-blue-900/50 p-2 rounded-lg whitespace-nowrap">
                     Azules: <span class="font-bold text-3xl">-</span>
                </div>
                <div id="current-turn" class="bg-gray-700 p-2 rounded-lg text-yellow-300 whitespace-nowrap">
                    Esperando inicio...
                </div>
                <div id="red-score" class="text-red-400 bg-red-900/50 p-2 rounded-lg whitespace-nowrap">
                     Rojos: <span class="font-bold text-3xl">-</span>
                </div>
            </div>

            <div id="game-controls" class="flex space-x-4 w-full sm:w-auto justify-end">
                <button id="pass-turn-btn"
                    class="bg-yellow-500 hover:bg-yellow-600 text-gray-900 font-bold py-3 px-6 rounded-full transition duration-150 text-xl w-full sm:w-auto shadow-lg hover:shadow-xl disabled:opacity-50 hidden">
                    Pasar Turno
                </button>
            </div>
        </div>

        <div id="start-buttons"
            class="flex flex-col sm:flex-row justify-center space-y-3 sm:space-y-0 sm:space-x-4 w-full">
            <button id="start-blue-btn"
                class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-full transition duration-150 text-xl w-full sm:w-auto shadow-lg hover:shadow-xl">
                 Empieza AZUL (9 Agentes)
            </button>
            <button id="start-random-btn"
                class="bg-gray-500 hover:bg-gray-600 text-white font-bold py-3 px-6 rounded-full transition duration-150 text-xl w-full sm:w-auto shadow-lg hover:shadow-xl">
                 Empieza ALEATORIO
            </button>
            <button id="start-red-btn"
                class="bg-red-600 hover:bg-red-700 text-white font-bold py-3 px-6 rounded-full transition duration-150 text-xl w-full sm:w-auto shadow-lg hover:shadow-xl">
                 Empieza ROJO (9 Agentes)
            </button>
        </div>

        <div id="game-board" class="grid grid-cols-5 gap-3 sm:gap-4 md:gap-5 w-full aspect-square">
        </div>
    </main>

    <footer class="mt-8 text-gray-500 text-sm">
        <p>A帽ade tu propia l贸gica JavaScript para manejar las pistas y el flujo del juego.</p>
    </footer>

    <script>
        // Importar las palabras desde el archivo externo
        import { PALABRAS_SECRETAS } from './palabras.js';

        const TIPOS_CARTA = {
            ROJO: 'red',
            AZUL: 'blue',
            NEUTRAL: 'neutral',
            ASESINO: 'assassin'
        };

        // --- VARIABLES DE ESTADO DEL JUEGO ---
        let tableroLogico = [];
        let juegoTerminado = false;
        let agentesRojosRestantes = 0;
        let agentesAzulesRestantes = 0;
        let turnoActual = TIPOS_CARTA.AZUL;
        // -------------------------------------

        /**
         * Funci贸n que encapsula toda la l贸gica para empezar una partida nueva.
         * @param {string} startingTeam - El color del equipo que empieza (TIPOS_CARTA.AZUL o TIPOS_CARTA.ROJO).
         */
        function inicializarJuego(startingTeam) {
            console.log(`Iniciando nueva partida. Empieza: ${startingTeam.toUpperCase()}`);

            // 1. Resetear variables de estado
            juegoTerminado = false;
            turnoActual = startingTeam;

            const firstTeam = startingTeam;
            const secondTeam = (firstTeam === TIPOS_CARTA.AZUL) ? TIPOS_CARTA.ROJO : TIPOS_CARTA.AZUL;

            // 2. Distribuci贸n de cartas: El equipo que empieza tiene 9, el otro 8.
            const tipos = [
                ...Array(9).fill(firstTeam),
                ...Array(8).fill(secondTeam),
                ...Array(7).fill(TIPOS_CARTA.NEUTRAL),
                TIPOS_CARTA.ASESINO
            ];

            let palabrasMezcladas = [...PALABRAS_EJEMPLO];
            let tiposMezclados = shuffleArray(tipos);

            tableroLogico = palabrasMezcladas.map((palabra, index) => ({
                word: palabra,
                type: tiposMezclados[index],
                revealed: false
            }));

            // 3. Establecer contadores y actualizar UI
            agentesAzulesRestantes = (firstTeam === TIPOS_CARTA.AZUL) ? 9 : 8;
            agentesRojosRestantes = (firstTeam === TIPOS_CARTA.ROJO) ? 9 : 8;

            ocultarBotonesInicio();

            // CORRECCIN CLAVE: Asegurar que el bot贸n de pasar turno est茅 habilitado.
            document.getElementById('pass-turn-btn').disabled = false;

            renderizarTablero();
            actualizarPuntuacion();
            actualizarIndicadorTurno();
        }

        /**
         * Muestra los botones de inicio y oculta los controles del juego.
         */
        function mostrarBotonesInicio() {
            document.getElementById('start-buttons').classList.remove('hidden');
            document.getElementById('pass-turn-btn').classList.add('hidden');

            // Mostrar un mensaje en el tablero vac铆o
            document.getElementById('game-board').innerHTML = '<div class="text-center text-gray-400 text-3xl p-10 col-span-5">Selecciona el equipo que empieza para comenzar una nueva partida.</div>';

            // Resetear indicadores de juego
            document.getElementById('current-turn').innerHTML = 'Esperando inicio...';
            document.querySelector('#blue-score span').textContent = '-';
            document.querySelector('#red-score span').textContent = '-';
        }

        /**
         * Oculta los botones de inicio y muestra los controles del juego.
         */
        function ocultarBotonesInicio() {
            document.getElementById('start-buttons').classList.add('hidden');
            document.getElementById('pass-turn-btn').classList.remove('hidden');
        }


        /**
         * Cambia el turno al equipo contrario y actualiza el indicador en la interfaz.
         */
        function cambiarTurno() {
            if (juegoTerminado) return;

            turnoActual = (turnoActual === TIPOS_CARTA.AZUL) ? TIPOS_CARTA.ROJO : TIPOS_CARTA.AZUL;
            actualizarIndicadorTurno();
            console.log(`隆Turno cambiado! Ahora es el turno del equipo ${turnoActual.toUpperCase()}.`);
        }

        /**
         * Actualiza el texto del turno en la interfaz.
         */
        function actualizarIndicadorTurno() {
            const color = (turnoActual === TIPOS_CARTA.AZUL) ? 'blue' : 'red';
            const textoTurno = (turnoActual === TIPOS_CARTA.AZUL) ? 'Azul ' : 'Rojo ';
            document.getElementById('current-turn').innerHTML = `Turno: <span class="text-${color}-400">${textoTurno}</span>`;
        }

        /**
         * Funci贸n principal para manejar la l贸gica al hacer click en una tarjeta.
         */
        function manejarClickTarjeta(event) {
            if (juegoTerminado) return;

            const cardDiv = event.currentTarget;
            const index = parseInt(cardDiv.getAttribute('data-index'));
            const cardData = tableroLogico[index];

            if (cardData.revealed) return;

            cardData.revealed = true;
            let cssClass = '';
            let finDeTurno = false;

            const equipoActual = turnoActual;

            switch (cardData.type) {
                case TIPOS_CARTA.ROJO:
                    cssClass = 'bg-red-agent';
                    agentesRojosRestantes--;
                    if (equipoActual === TIPOS_CARTA.AZUL) finDeTurno = true;
                    break;
                case TIPOS_CARTA.AZUL:
                    cssClass = 'bg-blue-agent';
                    agentesAzulesRestantes--;
                    if (equipoActual === TIPOS_CARTA.ROJO) finDeTurno = true;
                    break;
                case TIPOS_CARTA.NEUTRAL:
                    cssClass = 'bg-neutral-agent';
                    finDeTurno = true;
                    break;
                case TIPOS_CARTA.ASESINO:
                    cssClass = 'bg-assassin';
                    juegoTerminado = true;
                    break;
            }

            // Aplicar estilo de revelaci贸n y remover clases de interacci贸n
            cardDiv.className = `card ${cssClass} flex items-center justify-center p-1 sm:p-2 rounded-lg shadow-xl aspect-square`;
            cardDiv.classList.remove('cursor-pointer', 'hover:shadow-2xl', 'transition', 'duration-150', 'transform', 'hover:scale-[1.01]', 'bg-gray-200', 'text-gray-900');

            actualizarPuntuacion();

            // 1. Verificar si hay victoria o derrota por Asesino
            verificarFinJuego();

            // 2. Si no ha terminado, verificar si el turno debe cambiar autom谩ticamente
            if (!juegoTerminado && finDeTurno) {
                cambiarTurno();
            }
        }

        /**
         * Funci贸n para mezclar un array (Fisher-Yates).
         */
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        /**
         * Funci贸n que inserta las tarjetas en el DOM y asigna eventos.
         */
        function renderizarTablero() {
            const board = document.getElementById('game-board');
            board.innerHTML = '';

            tableroLogico.forEach((card, index) => {
                const cardDiv = document.createElement('div');
                cardDiv.className = 'card bg-gray-200 text-gray-900 flex items-center justify-center p-1 sm:p-2 rounded-lg shadow-xl cursor-pointer hover:shadow-2xl transition duration-150 transform hover:scale-[1.01] aspect-square';
                cardDiv.setAttribute('data-index', index);

                const textSpan = document.createElement('span');
                textSpan.className = 'card-text font-bold uppercase text-center';
                textSpan.textContent = card.word;

                cardDiv.appendChild(textSpan);
                board.appendChild(cardDiv);
            });

            // Asignar el Event Listener a todas las tarjetas
            document.querySelectorAll('.card').forEach(card => {
                card.addEventListener('click', manejarClickTarjeta);
            });
        }

        /**
         * Actualiza los contadores de agentes en la interfaz.
         */
        function actualizarPuntuacion() {
            document.querySelector('#blue-score span').textContent = agentesAzulesRestantes;
            document.querySelector('#red-score span').textContent = agentesRojosRestantes;
        }

        /**
         * Verifica las condiciones de victoria o derrota. Si el juego termina, muestra los botones de inicio.
         */
        function verificarFinJuego() {
            if (juegoTerminado) {
                // CORRECCIN CLAVE: Deshabilitar el bot贸n de pasar turno cuando el juego termina.
                document.getElementById('pass-turn-btn').disabled = true;

                let mensaje;
                if (agentesAzulesRestantes === 0) {
                    mensaje = '隆<span class="text-blue-400 font-bold">VICTORIA AZUL</span>! ';
                } else if (agentesRojosRestantes === 0) {
                    mensaje = '隆<span class="text-red-400 font-bold">VICTORIA ROJA</span>! ';
                } else {
                    // El juego termin贸 por el asesino.
                    const equipoGanador = (turnoActual === TIPOS_CARTA.AZUL) ? 'Rojo ' : 'Azul ';
                    mensaje = `隆JUEGO TERMINADO! <span class="text-red-500 font-bold">ASASINADO</span>. Gana: ${equipoGanador}`;
                }
                document.getElementById('current-turn').innerHTML = mensaje;

                // Mostrar los botones de inicio despu茅s de que el juego termine
                setTimeout(mostrarBotonesInicio, 1500);
            }
        }

        // 4. Inicializar la p谩gina en estado de espera y asignar manejadores de eventos.
        document.addEventListener('DOMContentLoaded', () => {
            // Estado inicial: mostrar botones de inicio, ocultar tablero.
            mostrarBotonesInicio();

            // --- Manejadores para los nuevos botones de inicio ---

            // Empieza Azul
            document.getElementById('start-blue-btn').addEventListener('click', () => {
                inicializarJuego(TIPOS_CARTA.AZUL);
            });

            // Empieza Rojo
            document.getElementById('start-red-btn').addEventListener('click', () => {
                inicializarJuego(TIPOS_CARTA.ROJO);
            });

            // Empieza Aleatorio
            document.getElementById('start-random-btn').addEventListener('click', () => {
                const randomTeam = Math.random() < 0.5 ? TIPOS_CARTA.AZUL : TIPOS_CARTA.ROJO;
                inicializarJuego(randomTeam);
            });

            // Manejador para el bot贸n "Pasar Turno"
            document.getElementById('pass-turn-btn').addEventListener('click', () => {
                if (!juegoTerminado) {
                    cambiarTurno();
                }
            });
        });
    </script>

</body>

</html>